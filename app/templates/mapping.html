<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>WooCommerce ‚Üí ERPNext Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- Local (root‚Äërelative so it respects http/https automatically) -->
    <link rel="stylesheet" href="/static/mapping.css">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="/static/mapping.js" defer></script>
</head>

<body>
    <noscript>
        <div class="alert alert-danger m-3">This page needs JavaScript enabled.</div>
    </noscript>

    <div class="container py-4">
        <h1 class="mb-4 text-center">WooCommerce ‚Üí ERPNext Admin Panel</h1>

        <!-- Alerts -->
        <div id="sync-alert" class="alert d-none" role="alert"></div>

        <!-- Sync Preview -->
        <div class="tw-wrap tw-card" id="sync-preview">
            <div class="sm:flex sm:items-center tw-hdr">
                <div class="sm:flex-auto">
                    <h2>Sync Preview</h2>
                    <p>Dry‚Äërun of what will be created, updated, or deleted.</p>
                </div>
                <div class="mt-3 mt-sm-0 sm:ml-16 sm:flex-none">
                    <button type="button" class="tw-btn-primary" onclick="runPreview()" data-bs-toggle="tooltip"
                        title="Perform a dry-run: detect what needs to be created, updated or deleted.">
                        üîÑ Refresh Preview
                    </button>
                </div>
            </div>

            <div class="tw-table-wrap">
                <div class="tw-table-inner sm:px-6 lg:px-8">
                    <div class="tw-shadow">
                        <table id="preview-table" class="tw-table">
                            <thead>
                                <tr>
                                    <th class="py-3.5 pr-3 pl-4 sm:pl-6">ERP Item Code / WC SKU</th>
                                    <th class="px-3 py-3.5">Action</th>
                                </tr>
                            </thead>
                            <tbody id="preview-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="text-end mt-3">
                <button class="btn btn-success me-2" onclick="triggerBulk('create')" data-bs-toggle="tooltip"
                    title="Create WooCommerce products that exist in ERPNext but not in Woo.">
                    ‚úÖ Create Missing
                </button>
                <button class="btn btn-warning me-2" onclick="triggerBulk('update')" data-bs-toggle="tooltip"
                    title="Push name/price/descriptions to Woo where differences are found.">
                    ‚úèÔ∏è Update Changes
                </button>
                <button class="btn btn-danger" onclick="triggerBulk('delete')" data-bs-toggle="tooltip"
                    title="Delete Woo products that no longer exist in ERPNext (orphans).">
                    üóë Delete Orphans
                </button>
            </div>
        </div>

        <!-- Product Mapping (auto) -->
        <div class="tw-wrap tw-card">
            <div class="sm:flex sm:items-center tw-hdr">
                <div class="sm:flex-auto">
                    <h2>Product Mapping (auto)</h2>
                    <p>ERP ‚Üî Woo detected matches. Rows in orange need attention.</p>
                </div>
                <div class="mt-3 mt-sm-0 sm:ml-16 sm:flex-none">
                    <button type="button" class="tw-btn-primary" onclick="reloadMapping()" data-bs-toggle="tooltip"
                        title="Reload mapping.json from disk">
                        Reload
                    </button>
                </div>
            </div>

            <div class="tw-table-wrap">
                <div class="tw-table-inner sm:px-6 lg:px-8">
                    <div class="tw-shadow">
                        <table id="mapping-table" class="tw-table">
                            <thead>
                                <tr>
                                    <th class="py-3.5 pr-3 pl-4 sm:pl-6">ERP Item Code</th>
                                    <th class="px-3 py-3.5">WC SKU</th>
                                    <th class="px-3 py-3.5">WC Product ID</th>
                                    <th class="px-3 py-3.5">Status</th>
                                    <th class="px-3 py-3.5">Last Synced</th>
                                    <th class="px-3 py-3.5">Last Price</th>
                                </tr>
                            </thead>
                            <tbody id="auto-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overrides -->
        <div class="tw-wrap tw-card">
            <div class="sm:flex sm:items-center tw-hdr">
                <div class="sm:flex-auto">
                    <h2>Overrides</h2>
                    <p>Force a Woo product ID for a given ERP item, or add notes.</p>
                </div>
            </div>

            <div class="tw-table-wrap">
                <div class="tw-table-inner sm:px-6 lg:px-8">
                    <div class="tw-shadow">
                        <table id="overrides-table" class="tw-table">
                            <thead>
                                <tr>
                                    <th class="py-3.5 pr-3 pl-4 sm:pl-6">ERP Item Code</th>
                                    <th class="px-3 py-3.5">Forced WC Product ID</th>
                                    <th class="px-3 py-3.5">Note</th>
                                    <th class="relative py-3.5 pr-4 pl-3 sm:pr-6"><span class="sr-only">Delete</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="overrides-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mt-3">
                <button type="button" class="tw-btn-secondary" onclick="addOverrideRow()" data-bs-toggle="tooltip"
                    title="Add an empty override row">
                    ‚ûï Add Override
                </button>
                <button class="btn btn-primary" onclick="saveOverrides()" data-bs-toggle="tooltip"
                    title="Write overrides back to mapping.json">
                    üíæ Save Overrides
                </button>
            </div>
        </div>
    </div>

</body>

</html>